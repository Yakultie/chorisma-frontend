{"ast":null,"code":"\"use strict\";\n\nconst DOMTokenList = require(\"../generated/DOMTokenList\");\nconst HTMLElementImpl = require(\"./HTMLElement-impl\").implementation;\nconst idlUtils = require(\"../generated/utils\");\nconst {\n  fetchStylesheet,\n  removeStylesheet\n} = require(\"../helpers/stylesheets\");\nconst {\n  parseURLToResultingURLRecord\n} = require(\"../helpers/document-base-url\");\nconst whatwgURL = require(\"whatwg-url\");\n\n// Important reading: \"appropriate times to obtain the resource\" in\n// https://html.spec.whatwg.org/multipage/semantics.html#link-type-stylesheet\n\nclass HTMLLinkElementImpl extends HTMLElementImpl {\n  constructor(globalObject, args, privateData) {\n    super(globalObject, args, privateData);\n    this.sheet = null;\n  }\n  get relList() {\n    if (this._relList === undefined) {\n      this._relList = DOMTokenList.createImpl(this._globalObject, [], {\n        element: this,\n        attributeLocalName: \"rel\",\n        supportedTokens: new Set([\"stylesheet\"])\n      });\n    }\n    return this._relList;\n  }\n  _attach() {\n    super._attach();\n    maybeFetchAndProcess(this);\n  }\n  _detach() {\n    super._detach();\n    if (this.sheet) {\n      removeStylesheet(this.sheet, this);\n    }\n  }\n  _attrModified(name, value, oldValue) {\n    super._attrModified(name, value, oldValue);\n    if (name === \"href\") {\n      // TODO crossorigin=\"\" or type=\"\"\n      maybeFetchAndProcess(this);\n    }\n    if (name === \"rel\" && this._relList !== undefined) {\n      this._relList.attrModified();\n    }\n  }\n  get _accept() {\n    return \"text/css,*/*;q=0.1\";\n  }\n}\nmodule.exports = {\n  implementation: HTMLLinkElementImpl\n};\n\n// https://html.spec.whatwg.org/multipage/links.html#link-type-stylesheet\nfunction maybeFetchAndProcess(el) {\n  if (!isExternalResourceLink(el)) {\n    return;\n  }\n\n  // Browsing-context connected\n  if (!el.isConnected || !el._ownerDocument._defaultView) {\n    return;\n  }\n  fetchAndProcess(el);\n}\n\n// https://html.spec.whatwg.org/multipage/semantics.html#default-fetch-and-process-the-linked-resource\n// TODO: refactor into general link-fetching like the spec.\nfunction fetchAndProcess(el) {\n  const href = el.getAttributeNS(null, \"href\");\n  if (href === null || href === \"\") {\n    return;\n  }\n  const url = parseURLToResultingURLRecord(href, el._ownerDocument);\n  if (url === null) {\n    return;\n  }\n\n  // TODO handle crossorigin=\"\", nonce, integrity=\"\", referrerpolicy=\"\"\n\n  const serialized = whatwgURL.serializeURL(url);\n  fetchStylesheet(el, serialized);\n}\nfunction isExternalResourceLink(el) {\n  // for our purposes, only stylesheets can be external resource links\n  const wrapper = idlUtils.wrapperForImpl(el);\n  if (!/(?:[ \\t\\n\\r\\f]|^)stylesheet(?:[ \\t\\n\\r\\f]|$)/i.test(wrapper.rel)) {\n    // rel is a space-separated list of tokens, and the original rel types\n    // are case-insensitive.\n    return false;\n  }\n  return el.hasAttributeNS(null, \"href\");\n}","map":{"version":3,"names":["DOMTokenList","require","HTMLElementImpl","implementation","idlUtils","fetchStylesheet","removeStylesheet","parseURLToResultingURLRecord","whatwgURL","HTMLLinkElementImpl","constructor","globalObject","args","privateData","sheet","relList","_relList","undefined","createImpl","_globalObject","element","attributeLocalName","supportedTokens","Set","_attach","maybeFetchAndProcess","_detach","_attrModified","name","value","oldValue","attrModified","_accept","module","exports","el","isExternalResourceLink","isConnected","_ownerDocument","_defaultView","fetchAndProcess","href","getAttributeNS","url","serialized","serializeURL","wrapper","wrapperForImpl","test","rel","hasAttributeNS"],"sources":["/Users/bernard/Downloads/my-app/node_modules/jsdom/lib/jsdom/living/nodes/HTMLLinkElement-impl.js"],"sourcesContent":["\"use strict\";\nconst DOMTokenList = require(\"../generated/DOMTokenList\");\nconst HTMLElementImpl = require(\"./HTMLElement-impl\").implementation;\nconst idlUtils = require(\"../generated/utils\");\nconst { fetchStylesheet, removeStylesheet } = require(\"../helpers/stylesheets\");\nconst { parseURLToResultingURLRecord } = require(\"../helpers/document-base-url\");\nconst whatwgURL = require(\"whatwg-url\");\n\n// Important reading: \"appropriate times to obtain the resource\" in\n// https://html.spec.whatwg.org/multipage/semantics.html#link-type-stylesheet\n\nclass HTMLLinkElementImpl extends HTMLElementImpl {\n  constructor(globalObject, args, privateData) {\n    super(globalObject, args, privateData);\n\n    this.sheet = null;\n  }\n\n  get relList() {\n    if (this._relList === undefined) {\n      this._relList = DOMTokenList.createImpl(this._globalObject, [], {\n        element: this,\n        attributeLocalName: \"rel\",\n        supportedTokens: new Set([\"stylesheet\"])\n      });\n    }\n    return this._relList;\n  }\n\n  _attach() {\n    super._attach();\n    maybeFetchAndProcess(this);\n  }\n\n  _detach() {\n    super._detach();\n    if (this.sheet) {\n      removeStylesheet(this.sheet, this);\n    }\n  }\n\n  _attrModified(name, value, oldValue) {\n    super._attrModified(name, value, oldValue);\n\n    if (name === \"href\") { // TODO crossorigin=\"\" or type=\"\"\n      maybeFetchAndProcess(this);\n    }\n\n    if (name === \"rel\" && this._relList !== undefined) {\n      this._relList.attrModified();\n    }\n  }\n\n  get _accept() {\n    return \"text/css,*/*;q=0.1\";\n  }\n}\n\nmodule.exports = {\n  implementation: HTMLLinkElementImpl\n};\n\n// https://html.spec.whatwg.org/multipage/links.html#link-type-stylesheet\nfunction maybeFetchAndProcess(el) {\n  if (!isExternalResourceLink(el)) {\n    return;\n  }\n\n  // Browsing-context connected\n  if (!el.isConnected || !el._ownerDocument._defaultView) {\n    return;\n  }\n\n  fetchAndProcess(el);\n}\n\n// https://html.spec.whatwg.org/multipage/semantics.html#default-fetch-and-process-the-linked-resource\n// TODO: refactor into general link-fetching like the spec.\nfunction fetchAndProcess(el) {\n  const href = el.getAttributeNS(null, \"href\");\n\n  if (href === null || href === \"\") {\n    return;\n  }\n\n  const url = parseURLToResultingURLRecord(href, el._ownerDocument);\n  if (url === null) {\n    return;\n  }\n\n  // TODO handle crossorigin=\"\", nonce, integrity=\"\", referrerpolicy=\"\"\n\n  const serialized = whatwgURL.serializeURL(url);\n\n  fetchStylesheet(el, serialized);\n}\n\nfunction isExternalResourceLink(el) {\n  // for our purposes, only stylesheets can be external resource links\n  const wrapper = idlUtils.wrapperForImpl(el);\n  if (!/(?:[ \\t\\n\\r\\f]|^)stylesheet(?:[ \\t\\n\\r\\f]|$)/i.test(wrapper.rel)) {\n    // rel is a space-separated list of tokens, and the original rel types\n    // are case-insensitive.\n    return false;\n  }\n\n  return el.hasAttributeNS(null, \"href\");\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}