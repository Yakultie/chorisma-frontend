{"ast":null,"code":"\"use strict\";\n\nconst whatwgURL = require(\"whatwg-url\");\nconst notImplemented = require(\"../../browser/not-implemented.js\");\nconst reportException = require(\"../helpers/runtime-script-errors.js\");\nconst idlUtils = require(\"../generated/utils.js\");\nexports.evaluateJavaScriptURL = (window, urlRecord) => {\n  const urlString = whatwgURL.serializeURL(urlRecord);\n  const encodedScriptSource = urlString.substring(\"javascript:\".length);\n  const scriptSource = Buffer.from(whatwgURL.percentDecodeString(encodedScriptSource)).toString();\n  if (window._runScripts === \"dangerously\") {\n    try {\n      return window.eval(scriptSource);\n    } catch (e) {\n      reportException(window, e, urlString);\n    }\n  }\n  return undefined;\n};\n\n// https://html.spec.whatwg.org/#navigating-across-documents\nexports.navigate = (window, newURL, flags) => {\n  // This is NOT a spec-compliant implementation of navigation in any way. It implements a few selective steps that\n  // are nice for jsdom users, regarding hash changes and JavaScript URLs. Full navigation support is being worked on\n  // and will likely require some additional hooks to be implemented.\n  if (!window._document) {\n    return;\n  }\n  const document = idlUtils.implForWrapper(window._document);\n  const currentURL = document._URL;\n  if (!flags.reloadTriggered && urlEquals(currentURL, newURL, {\n    excludeFragments: true\n  })) {\n    if (newURL.fragment !== currentURL.fragment) {\n      navigateToFragment(window, newURL, flags);\n    }\n    return;\n  }\n\n  // NOT IMPLEMENTED: Prompt to unload the active document of browsingContext.\n\n  // NOT IMPLEMENTED: form submission algorithm\n  // const navigationType = 'other';\n\n  // NOT IMPLEMENTED: if resource is a response...\n  if (newURL.scheme === \"javascript\") {\n    setTimeout(() => {\n      const result = exports.evaluateJavaScriptURL(window, newURL);\n      if (typeof result === \"string\") {\n        notImplemented(\"string results from 'javascript:' URLs\", window);\n      }\n    }, 0);\n    return;\n  }\n  navigateFetch(window);\n};\n\n// https://html.spec.whatwg.org/#scroll-to-fragid\nfunction navigateToFragment(window, newURL, flags) {\n  const document = idlUtils.implForWrapper(window._document);\n  window._sessionHistory.clearHistoryTraversalTasks();\n  if (!flags.replacement) {\n    // handling replacement=true here deviates from spec, but matches real browser behaviour\n    // see https://github.com/whatwg/html/issues/2796 for spec bug\n    window._sessionHistory.removeAllEntriesAfterCurrentEntry();\n  }\n  const newEntry = {\n    document,\n    url: newURL\n  };\n  window._sessionHistory.addEntryAfterCurrentEntry(newEntry);\n  window._sessionHistory.traverseHistory(newEntry, {\n    nonBlockingEvents: true,\n    replacement: flags.replacement\n  });\n}\n\n// https://html.spec.whatwg.org/#process-a-navigate-fetch\nfunction navigateFetch(window) {\n  // TODO:\n  notImplemented(\"navigation (except hash changes)\", window);\n}\n\n// https://url.spec.whatwg.org/#concept-url-equals\nfunction urlEquals(a, b, flags) {\n  const serializedA = whatwgURL.serializeURL(a, flags.excludeFragments);\n  const serializedB = whatwgURL.serializeURL(b, flags.excludeFragments);\n  return serializedA === serializedB;\n}","map":{"version":3,"names":["whatwgURL","require","notImplemented","reportException","idlUtils","exports","evaluateJavaScriptURL","window","urlRecord","urlString","serializeURL","encodedScriptSource","substring","length","scriptSource","Buffer","from","percentDecodeString","toString","_runScripts","eval","e","undefined","navigate","newURL","flags","_document","document","implForWrapper","currentURL","_URL","reloadTriggered","urlEquals","excludeFragments","fragment","navigateToFragment","scheme","setTimeout","result","navigateFetch","_sessionHistory","clearHistoryTraversalTasks","replacement","removeAllEntriesAfterCurrentEntry","newEntry","url","addEntryAfterCurrentEntry","traverseHistory","nonBlockingEvents","a","b","serializedA","serializedB"],"sources":["/Users/bernard/Downloads/my-app/node_modules/jsdom/lib/jsdom/living/window/navigation.js"],"sourcesContent":["\"use strict\";\nconst whatwgURL = require(\"whatwg-url\");\nconst notImplemented = require(\"../../browser/not-implemented.js\");\nconst reportException = require(\"../helpers/runtime-script-errors.js\");\nconst idlUtils = require(\"../generated/utils.js\");\n\nexports.evaluateJavaScriptURL = (window, urlRecord) => {\n  const urlString = whatwgURL.serializeURL(urlRecord);\n  const encodedScriptSource = urlString.substring(\"javascript:\".length);\n  const scriptSource = Buffer.from(whatwgURL.percentDecodeString(encodedScriptSource)).toString();\n  if (window._runScripts === \"dangerously\") {\n    try {\n      return window.eval(scriptSource);\n    } catch (e) {\n      reportException(window, e, urlString);\n    }\n  }\n  return undefined;\n};\n\n// https://html.spec.whatwg.org/#navigating-across-documents\nexports.navigate = (window, newURL, flags) => {\n  // This is NOT a spec-compliant implementation of navigation in any way. It implements a few selective steps that\n  // are nice for jsdom users, regarding hash changes and JavaScript URLs. Full navigation support is being worked on\n  // and will likely require some additional hooks to be implemented.\n  if (!window._document) {\n    return;\n  }\n\n  const document = idlUtils.implForWrapper(window._document);\n  const currentURL = document._URL;\n\n  if (!flags.reloadTriggered && urlEquals(currentURL, newURL, { excludeFragments: true })) {\n    if (newURL.fragment !== currentURL.fragment) {\n      navigateToFragment(window, newURL, flags);\n    }\n    return;\n  }\n\n  // NOT IMPLEMENTED: Prompt to unload the active document of browsingContext.\n\n  // NOT IMPLEMENTED: form submission algorithm\n  // const navigationType = 'other';\n\n  // NOT IMPLEMENTED: if resource is a response...\n  if (newURL.scheme === \"javascript\") {\n    setTimeout(() => {\n      const result = exports.evaluateJavaScriptURL(window, newURL);\n      if (typeof result === \"string\") {\n        notImplemented(\"string results from 'javascript:' URLs\", window);\n      }\n    }, 0);\n    return;\n  }\n  navigateFetch(window);\n};\n\n// https://html.spec.whatwg.org/#scroll-to-fragid\nfunction navigateToFragment(window, newURL, flags) {\n  const document = idlUtils.implForWrapper(window._document);\n\n  window._sessionHistory.clearHistoryTraversalTasks();\n\n  if (!flags.replacement) {\n    // handling replacement=true here deviates from spec, but matches real browser behaviour\n    // see https://github.com/whatwg/html/issues/2796 for spec bug\n    window._sessionHistory.removeAllEntriesAfterCurrentEntry();\n  }\n  const newEntry = { document, url: newURL };\n  window._sessionHistory.addEntryAfterCurrentEntry(newEntry);\n  window._sessionHistory.traverseHistory(newEntry, { nonBlockingEvents: true, replacement: flags.replacement });\n}\n\n// https://html.spec.whatwg.org/#process-a-navigate-fetch\nfunction navigateFetch(window) {\n  // TODO:\n  notImplemented(\"navigation (except hash changes)\", window);\n}\n\n// https://url.spec.whatwg.org/#concept-url-equals\nfunction urlEquals(a, b, flags) {\n  const serializedA = whatwgURL.serializeURL(a, flags.excludeFragments);\n  const serializedB = whatwgURL.serializeURL(b, flags.excludeFragments);\n  return serializedA === serializedB;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}